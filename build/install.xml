<?xml version="1.0" encoding="UTF-8"?>

<!--
 * Copyrights     : CNRS
 * Author         : Oleg Lodygensky
 * Acknowledgment : XtremWeb-HEP is based on XtremWeb 1.8.0 by inria : http://www.xtremweb.net/
 * Web            : http://www.xtremweb-hep.org
 * 
 *      This file is part of XtremWeb-HEP.
 *
 *    XtremWeb-HEP is free software: you can redistribute it and/or modify
 *    it under the terms of the GNU General Public License as published by
 *    the Free Software Foundation, either version 3 of the License, or
 *    (at your option) any later version.
 *
 *    XtremWeb-HEP is distributed in the hope that it will be useful,
 *    but WITHOUT ANY WARRANTY; without even the implied warranty of
 *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *    GNU General Public License for more details.
 *
 *    You should have received a copy of the GNU General Public License
 *    along with XtremWeb-HEP.  If not, see <http://www.gnu.org/licenses/>.
 *
-->


<!-- <!DOCTYPE project SYSTEM "ant.dtd" > -->
<!--    install.xml - Ant build file for the XWHEP sources
        created Fri Aug  9 10:49:46  2002 by Oleg Lodygensky
 -->
<project basedir=".." default="install" name="xwhep">
 
 <taskdef name="jarbundler" 
         classname="net.sourceforge.jarbundler.JarBundler" />
 <taskdef name="uuid" 
         classname="org.apache.commons.id.uuid.task.UUIDTask" />

  <!-- NAMES -->
  <property name="target.os" value="${os.name}"/>
  <property name="project" value="xwhep" />
  <property name="JARFILE" value="xtremweb.jar" />
  
   <!-- DIRECTORIES -->
  <property name="misc.dir" value="${basedir}/misc" />
  <property name="benchmark.dir" value="${basedir}/benchmark" />
  <property name="src.dir" value="${basedir}/src" />
  <property name="src.java.dir" value="${src.dir}/xtremweb" />
  <property name="src.c.dir" value="${src.dir}/natif" />
  <property name="src.scripts.dir" value="${src.dir}/scripts" />
  <property name="lib.dir" value="${basedir}/classes" />
  <property name="build.dir" value="${basedir}/build" />
  <property name="wrapper.dir" value="${build.dir}/wrapper" />
  <property name="build.classes" value="${build.dir}/classes" />
  <property name="installers.dir" value="${basedir}/installers" />
  <property name="innosetup.dir" value="${installers.dir}/win32/innoSetup" />
  <property name="msi.dir" value="${installers.dir}/win32/msi" />
  <property name="macosxpkg.dir" value="${installers.dir}/macosx" />
  <property name="macosxpkg.server" value="${macosxpkg.dir}/xwhep.server" />
  <property name="macosxpkg.worker" value="${macosxpkg.dir}/xwhep.worker" />
  <property name="macosxpkg.vworker" value="${macosxpkg.dir}/xwhep.vworker" />
  <property name="macosxpkg.client" value="${macosxpkg.dir}/xwhep.client" />
  <property name="rpm.dir" value="${installers.dir}/linux/rpm" />
  <property name="dpkg.dir" value="${installers.dir}/linux/dpkg" />
  <property name="xwidl.dir" value="${src.java.dir}/XwIDL" />
  <property name="antlr.dir" value="${src.java.dir}/antlr" />
  <property name="doc.dir" value="${basedir}/doc"/>
  <property name="install.www.dir" value="${build.dir}/WWW" />

    <!-- NEED TO CHANGE THE VERSION ? -->
    <condition property="version.changed">
      <or>
        <not><available file="${build.dir}/.build" /></not>
        <not>
          <uptodate targetfile="${build.dir}/.build">
            <srcfiles dir="${build.dir}" includes="VERSION" />
            <srcfiles dir="${src.java.dir}/common" includes="*"/>
            <srcfiles dir="${src.java.dir}/communications" includes="*"/>
            <srcfiles dir="${src.java.dir}/dispatcher" includes="*"/>
            <srcfiles dir="${src.java.dir}/archdep" includes="*"/>
	    <srcfiles dir="${src.java.dir}/exec" includes="*"/>
            <srcfiles dir="${src.java.dir}/worker" includes="*"/>
            <srcfiles dir="${src.java.dir}/services" includes="*"/>
            <srcfiles dir="${src.java.dir}/dispatcher" includes="*"/>
          </uptodate>
        </not>
      </or>
    </condition>

  <target if="version.changed" name="tstamp">
    <property file="${build.dir}/VERSION" prefix="v."/>
    <tstamp>
        <format pattern="yyyyMMddHHmm" property="v.build" />
    </tstamp>
    <echoproperties prefix="v." />
    <echoproperties prefix="v." destfile="${build.dir}/.build" /> 
  </target>

  <target depends="tstamp" name="version" >
    <property file="${build.dir}/.build" />    
    <property name="v.rev" value="${v.major}.${v.minor}.${v.micro}" />
<!--
    <property name="version" value="${v.rev}-${v.branch}-${v.build}" />
-->
    <property name="version" value="${v.rev}" />
  </target>
  

  <target name="prepareWWW">
    <property file="${build.dir}/build.conf"/>

    <mkdir dir="${install.www.dir}"/>
    <mkdir dir="${install.www.dir}/download"/>
    <mkdir dir="${install.www.dir}/db"/>

  </target>

  <target name="prepare" depends="version">
    <property file="${build.dir}/build.conf"/>

    <property name="installDir" value="${install.dir}/${ant.project.name}-${version}" />

    <property name="dist.dir" value="${build.dir}/dist/${ant.project.name}-${version}" />
    <property name="dist.lib" value="${dist.dir}/lib" />
    <property name="dist.doc" value="${dist.dir}/doc" />

    <property name="dist.dir.bin" value="${dist.dir}/bin" />
    <property name="dist.dir.keystore" value="${dist.dir}/keystore" />
    <property name="dist.dir.lib" value="${dist.dir}/lib" />
    <property name="dist.dir.installers" value="${dist.dir}/installers" />
    <property name="dist.dir.linux" value="${dist.dir.installers}/linux" />
    <property name="dist.dir.rpm" value="${dist.dir.linux}/rpm" />
    <property name="dist.dir.rpm.bridgedgsg" value="${dist.dir.rpm}/xwhep.bridgedgsg" />
    <property name="dist.dir.rpm.client" value="${dist.dir.rpm}/xwhep.client" />
    <property name="dist.dir.rpm.server" value="${dist.dir.rpm}/xwhep.server" />
    <property name="dist.dir.rpm.server.conf" value="${dist.dir.rpm}/xwhep.server.conf" />
    <property name="dist.dir.rpm.worker" value="${dist.dir.rpm}/xwhep.worker" />
    <property name="dist.dir.dpkg" value="${dist.dir.linux}/dpkg" />
    <property name="dist.dir.dpkg.bridgedgsg" value="${dist.dir.dpkg}/xwhep.bridgedgsg" />
    <property name="dist.dir.dpkg.client" value="${dist.dir.dpkg}/xwhep.client" />
    <property name="dist.dir.dpkg.server" value="${dist.dir.dpkg}/xwhep.server" />
    <property name="dist.dir.dpkg.server.conf" value="${dist.dir.dpkg}/xwhep.server.conf" />
    <property name="dist.dir.dpkg.worker" value="${dist.dir.dpkg}/xwhep.worker" />
    <property name="dist.dir.win32" value="${dist.dir.installers}/win32" />
    <property name="dist.dir.win32.client" value="${dist.dir.win32}/xwhep.client/" />
    <property name="dist.dir.client.innosetup" value="${dist.dir.win32.client}/innoSetup" />
    <property name="dist.dir.win32.worker" value="${dist.dir.win32}/xwhep.worker/" />
    <property name="dist.dir.worker.innosetup" value="${dist.dir.win32.worker}/innoSetup" />
    <property name="dist.dir.win32.server" value="${dist.dir.win32}/xwhep.server/" />
    <property name="dist.dir.server.innosetup" value="${dist.dir.win32.server}/innoSetup" />
    <property name="dist.dir.macosx" value="${dist.dir.installers}/macosx" />
    <property name="dist.dir.macosx.server" value="${dist.dir.macosx}/xwhep.server" />
    <property name="dist.dir.macosx.worker" value="${dist.dir.macosx}/xwhep.worker" />
    <property name="dist.dir.macosx.vworker" value="${dist.dir.macosx}/xwhep.vworker" />
    <property name="dist.dir.macosx.client" value="${dist.dir.macosx}/xwhep.client" />
    <property name="dist.dir.client" value="${dist.dir.installers}/xwhep.client/" />

    <!-- MAKE THE DIRECTORIES IF NEEDED -->
<!--
    <mkdir dir="${installDir}"/>
-->
  </target>

  
  <target name="configure" depends="prepare">
    <property file="${build.dir}/build.conf"/>

    <property environment="localEnv"/>
 
    <condition property="launcher.url" value="http://nohost/">
      <not>
        <isset property="${launcher.url}"/>
      </not>
    </condition>

    <condition property="system.user" value="xwhep">
      <not>
        <isset property="system.user" />
      </not>
    </condition>

    <condition property="dbUserPassword" value="${db.user.password}">
      <isset property="db.user.password"/>
    </condition>

    <condition property="dbUserPassword" value="${xtremweb.admin.password}">
      <not>
        <isset property="db.user.password"/>
      </not>
    </condition>

    <condition property="dbUserLogin" value="${db.user.login}">
      <isset property="db.user.login"/>
    </condition>

    <condition property="dbUserLogin" value="${xtremweb.admin.login}">
      <not>
        <isset property="db.user.login"/>
      </not>
    </condition>


<!-- ****************************************************** -->
<!-- ****************************************************** -->
<!-- We use upper case to conform to :                      -->
<!--           src/common/XWCPUs.java                       -->
<!--           src/common/XWOSes.java                       -->
<!-- ****************************************************** -->
<!-- ****************************************************** -->


    <condition property="xwarch" value="IX86">
      <or>
        <equals trim="true" arg1="${os.arch}" arg2="i86" />
        <equals trim="true" arg1="${os.arch}" arg2="x86" />
        <equals trim="true" arg1="${os.arch}" arg2="ix86" />
        <equals trim="true" arg1="${os.arch}" arg2="i386" />
        <equals trim="true" arg1="${os.arch}" arg2="x386" />
        <equals trim="true" arg1="${os.arch}" arg2="ix386" />
        <equals trim="true" arg1="${os.arch}" arg2="i486" />
        <equals trim="true" arg1="${os.arch}" arg2="x486" />
        <equals trim="true" arg1="${os.arch}" arg2="ix486" />
        <equals trim="true" arg1="${os.arch}" arg2="i586" />
        <equals trim="true" arg1="${os.arch}" arg2="x586" />
        <equals trim="true" arg1="${os.arch}" arg2="ix586" />
        <equals trim="true" arg1="${os.arch}" arg2="i686" />
        <equals trim="true" arg1="${os.arch}" arg2="x686" />
        <equals trim="true" arg1="${os.arch}" arg2="ix686" />
      </or>
    </condition>

    <condition property="xwarch" value="AMD64">
      <equals trim="true" arg1="${os.arch}" arg2="amd64" />
    </condition>

    <condition property="xwarch" value="x86_64">
      <equals trim="true" arg1="${os.arch}" arg2="x86_64" />
    </condition>

    <condition property="xwarch" value="PPC">
      <equals trim="true" arg1="${os.arch}" arg2="ppc" />
    </condition>

    <condition property="xwsuffix" value="LINUX-${xwarch}">
      <equals trim="true" arg1="${os.name}" arg2="Linux" />
    </condition>
    <condition property="xwsuffix" value="SOLARIS-SPARC">
      <equals trim="true" arg1="${os.name}" arg2="SunOS" />
    </condition>
    <condition property="xwsuffix" value="MACOSX-${xwarch}">
      <equals trim="true" arg1="${target.os}" arg2="Mac OS X" />
    </condition>
    <condition property="xwsuffix" value="WIN32-${xwarch}">
      <or>
	<equals trim="true" arg1="${os.name}" arg2="Windows NT" />
	<equals trim="true" arg1="${os.name}" arg2="Windows 2000" />
	<equals trim="true" arg1="${os.name}" arg2="Windows XP" />
      </or>
    </condition>

    <condition property="dbEngine" value="ENGINE = ${db.engine}">
      <isset property="db.engine"/>
    </condition>
    <condition property="dbEngine" value="">
      <not>
        <isset property="db.engine"/>
      </not>
    </condition>

   <condition property="dbSuPassword" value="${db.su.password}">
      <isset property="db.su.password"/>
    </condition>

    <condition property="dbSuPassword" value="">
      <not>
        <isset property="db.su.password"/>
      </not>
    </condition>

    <condition property="dbSuName" value="${db.su.login}">
      <isset property="db.su.login"/>
    </condition>

    <condition property="dbSuName" value="">
      <not>
        <isset property="db.su.login"/>
      </not>
    </condition>

<echo>
user  login : ${dbUserLogin} ${dbUserPassword}
admin login : ${xtremweb.admin.login} ${xtremweb.admin.password}
DB su login : ${dbSuName} ${dbSuPassword}
ENGINE : &quot;${dbEngine}&quot;
launcher.url = ${launcher.url}
system.user  = ${system.user}
xwsuffix=${xwsuffix}
xwarch=${xwarch}
target.os=${target.os}
cross.prefix=${cross.prefix}
cross.java.home=${cross.java.home}
version=${version}
</echo>

  </target>


  <target name="installConfig" depends="prepare, configure">

    <property file="${build.dir}/.build" />    
    <property name="v.rev" value="${v.major}.${v.minor}.${v.micro}" />
    <property name="version" value="${v.rev}-${v.branch}-${v.build}" />
    <echo>
       ==> version    = ${version}
       ==> dist.dir   = ${dist.dir}
       ==> installDir = ${installDir}
    </echo>

  </target>


  <!-- ************************ UNINSTALL ************************ -->

  <target name="uninstall" depends="configure">

    <delete dir="${dist.dir}"
            failonerror="false"
            includeEmptyDirs="true"/>
    <echo>
      Uninstall done

      Note : Database not removed (except if called by uninstallAll)
             To remove both, use uninstallAll
    </echo>
  </target>

  <target name="uninstallAll" depends="uninstall, removeDB">

    <delete dir="${install.www.dir}"
            failonerror="false"
            includeEmptyDirs="true"/>

    <echo>
      Done
    </echo>
  </target>

  <target name="removeDB" depends="installConfig">
    <sql classpath="${lib.dir}/mysql-connector-java-5.1.6-bin.jar"
	 driver="com.mysql.jdbc.Driver"
	 url="jdbc:mysql://${db.host}/${db.name}"
	 userid="${dbSuName}"
	 password="${dbSuPassword}"
	 src="${src.scripts.dir}/xwrmdb.sql">
    </sql>

    <echo>
      Database tables removed
      Database itself should be removed manually!
    </echo>
  </target>


  <!-- ************************ INSTALL WORKER ******************** -->
  
  <target name="installWorker" depends="installFiles">
    <echo>
      Done
    </echo>
  </target>

  <!-- ************************ INSTALL ************************** -->
  
  <target name="install" depends="installWebFiles,ganglia">
    <chmod dir="${install.www.dir}/db/" 
	   perm="775" includes="**" type="both"/>
    <chmod dir="${install.www.dir}/download/"
	   perm="755" type="both" includes="**"/>
    <chmod dir="${dist.dir.bin}"
	   perm="755" type="both" includes="**"/>
    <chmod dir="${dist.dir.bin}"
	   perm="-x" type="both" includes="*.sql*"/>
    <chmod dir="${dist.dir.bin}"
	   perm="-x" type="both" includes="*.seds"/>
    <chmod dir="${dist.dir.bin}"
	   perm="-x" type="both" includes="*.bat"/>
    <chmod dir="${dist.dir.bin}"
	   perm="-x" type="both" includes="*.xmls"/>

    <echo>
      Installation done
    </echo>
  </target>



  <target name="installFiles" depends="installConfig">



    <!-- ********************************************** -->
    <!-- **** Note that every following copies uses *** -->
    <!-- ****  filtering (i.e. uses defined tokens) *** -->
    <!-- ****                                       *** -->
    <!-- **** Important :                           *** -->
    <!-- ****    - the dispatcher stores the user   *** -->
    <!-- ****      password uncoded to connect to   *** -->
    <!-- ****      MySQL server                     *** -->
    <!-- ****    - the other parts (worker, client) *** -->
    <!-- ****      store the user password uncoded  *** -->
    <!-- ****      to connect to Xwhep server    *** -->
    <!-- ****      since communications are now     *** -->
    <!-- ****      encrypted                        *** -->
    <!-- ****                                       *** -->
    <!-- ********************************************** -->
    
    <patternset id="XW-DOC">
      <include name="xtremweb.html" />
      <include name="*png" />
    </patternset>
    <copy todir="${dist.dir}/doc/"
          filtering="no" overwrite="yes">
      <fileset dir="${doc.dir}">
	<patternset refid="XW-DOC" />
      </fileset>
    </copy>
    
    <patternset id="XW-LIBS">
      <include name="*" />
    </patternset>
    <copy todir="${dist.dir}/lib/"
          filtering="no" overwrite="yes">
      <fileset dir="${lib.dir}">
	<patternset refid="XW-LIBS" />
      </fileset>
    </copy>

    <copy todir="${dist.dir.macosx.server}/installer/PckRoot/private/etc/xwhep.server/lib"
          filtering="no" overwrite="yes">
      <fileset dir="${lib.dir}">
	<patternset refid="XW-LIBS" />
      </fileset>
    </copy>
    
    <condition property="installedDBUser" value="true">
      <equals trim="true" arg1="${insertDBUser}" arg2="true">
      </equals>
    </condition>
    <!--
	<delete file="${build.dir}/dbusers.property" />
	-->
    <!-- **** Create java-config script file **** -->
    <filter token="INSTALLDIR" value="${installDir}"/>
    <filter token="HOMEDIR" value="/var/xwhep" />
    <filter token="KEYDIR" value="${installDir.keystore}" />

    <!-- Install config files -->

    <copy file="${misc.dir}/xtremweb.server.conf.in" 
          filtering="yes" overwrite="yes"
          tofile="${dist.dir}/conf/xtremweb.server.conf" />
    
    <filter token="DATASERVERS" value="${data.servers}"/>
    <filter token="XWUSER" value="${xw.user}"/>
    <filter token="XWPASSWORD" value="${xw.password}"/>
    <filter token="LAUNCHERURL" value="${launcher.url}"/>

    <echo>
      xtremweb.admin.login=${xtremweb.admin.login}
      xtremweb.admin.password=${xtremweb.admin.password}
    </echo>

    <copy file="${misc.dir}/xtremweb.client.conf.in" 
          tofile="${dist.dir}/conf/xtremweb.client.conf"
          filtering="yes" overwrite="yes" />
    <copy file="${misc.dir}/xtremweb.client.conf.in" 
          tofile="${dist.dir}/conf/xtremweb.client.conf.template"
          filtering="no" overwrite="yes" />

    <filter token="KEYDIR" value="."/>

    <filter token="DEFAULTUSER" value=""/>
    <filter token="DEFAULTPASSWORD" value=""/>
    <filter token="DEFAULTUSER" value="${xtremweb.worker.login}"/>
    <filter token="DEFAULTPASSWORD" value="${xtremweb.worker.password}"/>

    <echo>
      xtremweb.worker.login=${xtremweb.worker.login}
      xtremweb.worker.password=${xtremweb.worker.password}
    </echo>

    <mkdir dir="${dist.dir.keystore}" />
    <filter token="KEYDIR" value="${installDir.keystore}" />

    <copy file="${misc.dir}/xtremweb.worker.conf.in" 
          tofile="${dist.dir}/conf/xtremweb.worker.conf"
          filtering="yes" overwrite="yes" />

    <filter token="KEYDIR" value="/private/etc/xwhep.worker"/>

    <copy file="${misc.dir}/xtremweb.worker.conf.in" 
          tofile="${dist.dir.macosx.worker}/installer/PckRoot/private/etc/xwhep.worker/conf/xtremweb.worker.conf"
          filtering="yes" overwrite="yes" />
    <copy file="${misc.dir}/worker-start.html" 
          tofile="${dist.dir.macosx.worker}/installer/PckRoot/Applications/xwhep.worker/index.html"
          filtering="no" overwrite="yes" />
    <copy file="${misc.dir}/xwhep.sb" 
          todir="${dist.dir.macosx.worker}/installer/PckRoot/private/etc/xwhep.worker/conf"
          filtering="no" overwrite="yes" />
    <copy file="${misc.dir}/worker-start.html" 
          tofile="${dist.dir.macosx.vworker}/installer/PckRoot/Applications/xwhep.vworker/index.html"
          filtering="no" overwrite="yes" />
    <copy file="${src.scripts.dir}/xwstartvm.sh" 
          todir="${dist.dir.macosx.vworker}/installer/PckRoot/private/etc/xwhep.vworker/bin"
          filtering="no" overwrite="yes" />

    <copy file="${misc.dir}/xtremweb.client.conf.in" 
          tofile="${dist.dir.macosx.client}/installer/PckRoot/Applications/xwhep.client/conf/xtremweb.client.conf"
          filtering="yes" overwrite="yes" />

    <filter token="KEYDIR" value="/private/etc/xwhep.server"/>

    <copy file="${misc.dir}/xtremweb.server.conf.in" 
          tofile="${dist.dir.macosx.server}/installer/PckRoot/private/etc/xwhep.server/conf/xtremweb.server.conf"
          filtering="yes" overwrite="yes" />
    <mkdir dir="${dist.dir.macosx.server}/installer/PckRoot/Applications/xwhep.server/doc" />
    <copy todir="${dist.dir.macosx.server}/installer/PckRoot/Applications/xwhep.server/doc"
          filtering="no" overwrite="yes">
      <fileset dir="${doc.dir}">
	<patternset refid="XW-DOC" />
      </fileset>
    </copy>

    <filter token="KEYDIR" value="../keystore"/>


    <!-- Install Win32 Client -->


    <copy file="${misc.dir}/xtremweb.client.conf.in" 
          tofile="${dist.dir.win32.client}/conf/xtremweb.client.conf"
          filtering="yes" overwrite="yes" />
    <mkdir dir="${dist.dir.client.innosetup}/client/bin" />
    <mkdir dir="${dist.dir.client.innosetup}/client/conf" />
    <mkdir dir="${dist.dir.client.innosetup}/client/doc" />
    <mkdir dir="${dist.dir.client.innosetup}/client/keystore" />
    <mkdir dir="${dist.dir.client.innosetup}/client/lib" />
    <copy file="${misc.dir}/xtremweb.client.conf.in" 
          tofile="${dist.dir.client.innosetup}/client/conf/xtremweb.client.conf"
          filtering="yes" overwrite="yes" />


    <!-- Install Win32 Worker -->


    <copy file="${misc.dir}/xtremweb.worker.conf.in" 
          tofile="${dist.dir.win32.worker}/conf/xtremweb.worker.conf"
          filtering="yes" overwrite="yes" />
    <mkdir dir="${dist.dir.worker.innosetup}/worker/bin" />
    <mkdir dir="${dist.dir.worker.innosetup}/worker/conf" />
    <mkdir dir="${dist.dir.worker.innosetup}/worker/doc" />
    <mkdir dir="${dist.dir.worker.innosetup}/worker/keystore" />
    <mkdir dir="${dist.dir.worker.innosetup}/worker/lib" />
    <mkdir dir="${dist.dir.worker.innosetup}/worker/misc" />
    <copy file="${misc.dir}/xtremweb.worker.conf.in" 
          tofile="${dist.dir.worker.innosetup}/worker/conf/xtremweb.worker.conf"
          filtering="yes" overwrite="yes" />
    <copy file="${build.dir}/wrapper/conf/wrapper-worker.conf" 
          tofile="${dist.dir.win32.worker}/conf/wrapper-worker.conf"
          filtering="no" overwrite="yes" />
    <copy file="${build.dir}/wrapper/conf/wrapper-worker.conf" 
          tofile="${dist.dir.worker.innosetup}/worker/conf/wrapper-worker.conf"
          filtering="no" overwrite="yes" />
    <copy todir="${dist.dir.win32.worker}/lib/"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/lib">
	      <include name="*" />
      </fileset>
    </copy>
    <copy todir="${dist.dir.worker.innosetup}/worker/lib/"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/lib">
	      <include name="*" />
      </fileset>
    </copy>

    <copy todir="${dist.dir.worker.innosetup}/worker/lib/"
          filtering="no" overwrite="yes"
	  file="${installers.dir}/win32/cygwin1.dll" />
    <copy todir="${dist.dir.worker.innosetup}/worker/lib/"
          filtering="no" overwrite="yes"
	  file="${installers.dir}/win32/cygwin1.dll" />
    <copy todir="${dist.dir.worker.innosetup}/worker/misc/"
          filtering="no" overwrite="yes"
	  file="${src.c.dir}/xwwrk.ico" />
    <copy todir="${dist.dir.worker.innosetup}/worker/doc"
          filtering="no" overwrite="yes"
	  file="${misc.dir}/worker-start.html" />
    <copy todir="${dist.dir.win32.worker}/bin"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/bin">
	      <include name="*" />
      </fileset>
    </copy>
    <copy todir="${dist.dir.worker.innosetup}/worker/bin"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/bin">
	      <include name="InstallXWWorker-NT.bat" />
	      <include name="StartXWWorker-NT.bat" />
	      <include name="UninstallXWWorker-NT.bat" />
	      <include name="Wrapper.exe" />
	      <include name="xtremweb.worker.bat" />
      </fileset>
    </copy>
    <copy todir="${dist.dir.win32.worker}/doc"
          filtering="no" overwrite="yes"
	  file="${misc.dir}/worker-start.html" />


    <!-- Install Win32 Server -->


    <copy file="${misc.dir}/xtremweb.server.conf.in" 
          tofile="${dist.dir.win32.server}/conf/xtremweb.server.conf"
          filtering="yes" overwrite="yes" />
    <mkdir dir="${dist.dir.server.innosetup}/server/bin" />
    <mkdir dir="${dist.dir.server.innosetup}/server/conf" />
    <mkdir dir="${dist.dir.server.innosetup}/server/doc" />
    <mkdir dir="${dist.dir.server.innosetup}/server/keystore" />
    <mkdir dir="${dist.dir.server.innosetup}/server/lib" />
    <mkdir dir="${dist.dir.server.innosetup}/server/misc" />
    <copy file="${misc.dir}/xtremweb.server.conf.in" 
          tofile="${dist.dir.server.innosetup}/server/conf/xtremweb.server.conf"
          filtering="yes" overwrite="yes" />
    <copy file="${build.dir}/wrapper/conf/wrapper-server.conf" 
          tofile="${dist.dir.win32.server}/conf/wrapper-server.conf"
          filtering="no" overwrite="yes" />
    <copy file="${build.dir}/wrapper/conf/wrapper-server.conf" 
          tofile="${dist.dir.server.innosetup}/server/conf/wrapper-server.conf"
          filtering="no" overwrite="yes" />
    <copy todir="${dist.dir.win32.server}/lib/"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/lib">
	      <include name="*" />
      </fileset>
    </copy>
    <copy todir="${dist.dir.server.innosetup}/server/lib/"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/lib">
	      <include name="*" />
      </fileset>
    </copy>

    <copy todir="${dist.dir.server.innosetup}/server/misc/"
          filtering="no" overwrite="yes"
	  file="${src.c.dir}/xwwrk.ico" />
    <copy todir="${dist.dir.server.innosetup}/server/bin"
          filtering="no" overwrite="yes">
      <fileset dir="${build.dir}/wrapper/bin">
	      <include name="InstallXWServer-NT.bat" />
	      <include name="StartXWServer-NT.bat" />
	      <include name="UninstallXWServer-NT.bat" />
	      <include name="Wrapper.exe" />
	      <include name="xtremweb.server.bat" />
      </fileset>
    </copy>
  </target>


  <target name="ganglia" if="ganglia.www.dir" depends="installConfig,prepareWWW">
    <echo>
      Installing ganglia ${ant.project.name} template
    </echo>
    <copy overwrite="yes" todir="${ganglia.www.dir}/templates">
      <fileset dir="${basedir}/php/ganglia/templates/"/>
    </copy>
  </target>


  <target name="installWebFiles" depends="installConfig, prepareWWW, createDownload">

        <!-- ********************************************** -->
        <!-- **** Note that every following copies uses *** -->
        <!-- ****  filtering (i.e. uses defined tokens) *** -->
        <!-- ********************************************** -->

        <!-- **** Create java-config script file **** -->
    <filter token="DBVENDOR" value="${db.system}"/>
    <filter token="DBHOST" value="${db.host}"/>
    <filter token="DBNAME" value="${db.name}" />   
    <filter token="DBUSER" value="${dbUserLogin}"/>
    <filter token="DBPASSWORD" value="${dbUserPassword}"/>
    <filter token="HOMEDIR" value="${install.www.dir}/db"/>
    <filter token="KEYDIR" value="${installDir.keystore}"/>
    <filter token="PROJECTNAME" value="${project}"/>
    <filter token="DATASERVERS" value="${data.servers}"/>
    <filter token="XWUSER" value="${xw.user}"/>
    <filter token="XWPASSWORD" value="${xw.password}"/>
    <filter token="KEYPASSPHRASE" value="${xw.keypassphrase}"/>
    <filter token="KEYSERVERPASSWORD" value="${xw.server.keypassword}"/>
    <filter token="KEYWORKERPASSWORD" value="${xw.worker.keypassword}"/>
    <filter token="KEYCLIENTPASSWORD" value="${xw.client.keypassword}"/>
    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>

    <copy overwrite="yes" todir="${install.www.dir}">
      <fileset dir="${basedir}/php"/>
    </copy>

    <move filtering="yes" overwrite="yes"
          file="${install.www.dir}/php/config/library.php.in" 
          tofile="${install.www.dir}/php/config/library.php"/>

    <move filtering="yes" overwrite="yes"
          file="${install.www.dir}/php/config/version.php.in" 
          tofile="${install.www.dir}/php/config/version.php"/>

    <move filtering="yes" overwrite="yes"
          file="${install.www.dir}/templates/{PAGE}.html.in" 
          tofile="${install.www.dir}/templates/{PAGE}.html"/>
    <move filtering="yes" overwrite="yes"
          file="${install.www.dir}/textes/contact.php.in" 
          tofile="${install.www.dir}/textes/contact.php"/>

    <move filtering="yes" overwrite="yes"
          file="${install.www.dir}/textes/register.php.in" 
          tofile="${install.www.dir}/textes/register.php"/>

    <move filtering="yes" overwrite="yes"
          file="${install.www.dir}/textes/bugreport_action.php.in" 
          tofile="${install.www.dir}/textes/bugreport_action.php"/>

  </target>


  <target name="createDownload" depends="installScripts">

    <delete file="${build.dir}/stand-alone/${JARFILE}" />
    <delete dir="${build.dir}/stand-alone/xtremweb/" />
    <delete dir="${build.dir}/stand-alone/xwclasses/" />
    <delete dir="${build.dir}/stand-alone/jni/" />

    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>

    <!-- Create the stand alone JAR file for the worker -->

    <exec dir="${build.dir}/stand-alone" executable="sh" 
     failonerror="true" os="Linux, Mac OS X">
      <arg line="make-standalone.sh -f ${dist.lib}/${JARFILE}"/>
      <env key="XWSUFFIX" value="${xwsuffix}" />
      <env key="XWARCH"   value="${xwarch}" />
      <env key="TARGET"   value="${target.os}" />
      <env key="CROSS"    value="${cross.prefix}" />
      <env key="XWVERSION" value="${version}" />
    </exec>

    <exec dir="${build.dir}/stand-alone" executable="cmd.exe" 
     failonerror="true" os="Windows XP, Windows 2000">
      <arg line="/E:ON /C make-standalone.bat -f &quot;${dist.lib}\${JARFILE}&quot;"/>
      <env key="XWSUFFIX" value="${xwsuffix}" />
      <env key="XWARCH"   value="${xwarch}" />
      <env key="TARGET"   value="${target.os}" />
      <env key="CROSS"    value="${cross.prefix}" />
      <env key="XWVERSION" value="${version}" />
    </exec>

      <!-- Install downloadable worker -->
    <copy file="${build.dir}/stand-alone/${JARFILE}"
          tofile="${install.www.dir}/download/${JARFILE}"
          overwrite="yes" />

      <!-- Install worker wrapper -->
    <copy file="${build.dir}/stand-alone/${JARFILE}"
          tofile="${dist.dir}/lib/${JARFILE}"
          overwrite="yes" />

      <!-- Install Mac OS X  -->
    <copy file="${build.dir}/stand-alone/${JARFILE}"
          todir="${dist.dir.macosx.worker}/installer/PckRoot/private/etc/xwhep.worker/lib"
          overwrite="yes" />
    <copy file="${dist.dir.keystore}/xwhepworker.keys" 
          todir="${dist.dir.macosx.worker}/installer/PckRoot/private/etc/xwhep.worker/keystore"
          failonerror="no" filtering="no" overwrite="yes" />

    <copy file="${build.dir}/stand-alone/${JARFILE}"
          todir="${dist.dir.macosx.client}/installer/PckRoot/Applications/xwhep.client/lib"
          overwrite="yes" />
    <copy file="${lib.dir}/bcprov-jdk15on-151.jar"
          todir="${dist.dir.macosx.client}/installer/PckRoot/Applications/xwhep.client/lib"
          overwrite="yes" />
    <copy file="${lib.dir}/bcpkix-jdk15on-151.jar"
          todir="${dist.dir.macosx.client}/installer/PckRoot/Applications/xwhep.client/lib"
          overwrite="yes" />
    <copy file="${dist.dir.keystore}/xwhepclient.keys" 
          todir="${dist.dir.macosx.client}/installer/PckRoot/Applications/xwhep.client/keystore"
          failonerror="no" filtering="no" overwrite="yes" />

    <copy file="${build.dir}/stand-alone/${JARFILE}"
          todir="${dist.dir.macosx.server}/installer/PckRoot/private/etc/xwhep.server/lib"
          overwrite="yes" />
    <copy file="${dist.dir.keystore}/xwhepserver.keys" 
          todir="${dist.dir.macosx.server}/installer/PckRoot/private/etc/xwhep.server/keystore"
          failonerror="no" filtering="no" overwrite="yes" />

    <copy file="${src.scripts.dir}/db-maintenance/xwhep-core-tables-create-tables.sql.in"
          filtering="no" overwrite="yes"
          todir="${dist.dir.bin}/db-maintenance" />
    <copy file="${src.scripts.dir}/db-maintenance/xwsetversion.sql.in"
          filtering="yes" overwrite="yes"
          tofile="${dist.dir.bin}/db-maintenance/xwsetversion.sql">
      <filterset>
	<filter token="XWVERSION" value="${version}"/>
      </filterset>
    </copy>

    <copy file="${src.scripts.dir}/xwconfigure"
          overwrite="yes"
          todir="${dist.dir.bin}" >
      <filterset begintoken="%" endtoken="%">
	<filter token="INSTALLDIR" value="${install.dir}"/>
	<filter token="XWVERSION" value="${version}"/>
	<filter token="SYSTEMUSER" value="${system.user}"/>
      </filterset>
    </copy>

    <copy todir="${dist.doc}/xwhep.client/doc"
          filtering="no" overwrite="yes">
      <fileset dir="${doc.dir}">
	      <patternset refid="XW-DOC" />
      </fileset>
    </copy>
    <jarbundler dir="${dist.dir.bin}"
		name="xwhep.client"
		bundleid="xwhep.client.Client" 
		build="${version}"
		version="${version}"
		developmentregion="French"
		jvmversion="1.5+"
		icon="${misc.dir}/xwicons4.icns"
		vmoptions="-Djavax.net.ssl.trustStore=../keystore/xwhepclient.keys"
		stubfile="${macosxpkg.dir}/JavaApplicationStub"
		mainclass="xtremweb.client.Client" 
		arguments="--xwgui --xwconfig ../conf/xtremweb.client.conf" 
		jar="${dist.dir.lib}/${JARFILE}"
		/>

    <mkdir  dir="${dist.dir.bin}/xwhep.client.app" />
    <copy todir="${dist.dir.bin}/xwhep.client.app"
          filtering="yes" overwrite="yes">
      <fileset dir="${dist.dir.bin}/xwhep.client.app" />
    </copy>

    <mkdir  dir="${dist.dir.macosx.client}" />
    <mkdir  dir="${dist.dir.macosx.worker}" />
    <mkdir  dir="${dist.dir.macosx.vworker}" />
    <mkdir  dir="${dist.dir.macosx.server}" />
    <mkdir  dir="${dist.dir.worker.innosetup}" />
    <mkdir  dir="${dist.dir.server.innosetup}" />
    <mkdir  dir="${dist.dir.rpm.bridgedgsg}" />
    <mkdir  dir="${dist.dir.rpm.client}" />
    <mkdir  dir="${dist.dir.rpm.server}" />
    <mkdir  dir="${dist.dir.rpm.server.conf}" />
    <mkdir  dir="${dist.dir.rpm.worker}" />

    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>

    <copy todir="${dist.dir.macosx.worker}"
          filtering="yes" overwrite="yes">
      <fileset dir="${macosxpkg.worker}" />
    </copy>
    <copy todir="${dist.dir.macosx.vworker}"
          filtering="yes" overwrite="yes">
      <fileset dir="${macosxpkg.vworker}" />
    </copy>
    <copy todir="${dist.dir.macosx.client}"
          filtering="yes" overwrite="yes">
      <fileset dir="${macosxpkg.client}" />
    </copy>
    <copy todir="${dist.dir.macosx.server}"
          filtering="yes" overwrite="yes">
      <fileset dir="${macosxpkg.server}" />
    </copy>
    <copy todir="${dist.dir.worker.innosetup}"
          filtering="yes" overwrite="yes">
      <fileset dir="${innosetup.dir}" />
    </copy>
    <copy todir="${dist.dir.win32.worker}"
          filtering="yes" overwrite="yes">
      <fileset file="${installers.dir}/win32/cygwin1.dll" />
    </copy>
    <copy todir="${dist.dir.server.innosetup}"
          filtering="yes" overwrite="yes">
      <fileset dir="${innosetup.dir}" />
    </copy>

    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>
    <copy todir="${dist.dir.rpm.server}"
          file="${rpm.dir}/xwhep-server.spec"
	  filtering="yes" overwrite="yes" />
    <copy todir="${dist.dir.rpm.server.conf}"
          file="${rpm.dir}/xwhep-server-conf.spec"
	  filtering="yes" overwrite="yes" />

    <mkdir  dir="${dist.dir.dpkg.server}/DEBIAN" />
  	<copy tofile="${dist.dir.dpkg.server}/DEBIAN/control"
          file="${dpkg.dir}/xwhep-server.control"
          filtering="yes" overwrite="yes" />
  	<copy todir="${dist.dir.dpkg.server}/DEBIAN/"
          file="${dpkg.dir}/copyright"
          filtering="no" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server}/DEBIAN/preinst"
          file="${dpkg.dir}/xwhep-server.preinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server}/DEBIAN/postinst"
          file="${dpkg.dir}/xwhep-server.postinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server}/DEBIAN/prerm"
          file="${dpkg.dir}/xwhep-server.prerm"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server}/DEBIAN/postrm"
          file="${dpkg.dir}/xwhep-server.postrm"
          filtering="yes" overwrite="yes" />

    <mkdir  dir="${dist.dir.dpkg.server.conf}/DEBIAN" />
    <copy todir="${dist.dir.dpkg.server.conf}/DEBIAN/"
          file="${dpkg.dir}/copyright"
          filtering="no" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server.conf}/DEBIAN/control"
          file="${dpkg.dir}/xwhep-server-conf.control"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server.conf}/DEBIAN/preinst"
          file="${dpkg.dir}/xwhep-server-conf.preinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server.conf}/DEBIAN/postinst"
          file="${dpkg.dir}/xwhep-server-conf.postinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server.conf}/DEBIAN/prerm"
          file="${dpkg.dir}/xwhep-server-conf.prerm"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.server.conf}/DEBIAN/postrm"
          file="${dpkg.dir}/xwhep-server-conf.postrm"
          filtering="yes" overwrite="yes" />

    <mkdir  dir="${dist.dir.dpkg.bridgedgsg}/DEBIAN" />
    <copy todir="${dist.dir.rpm.bridgedgsg}"
          file="${rpm.dir}/xwhep-bridgedgsg.spec"
	  filtering="yes" overwrite="yes" />
    <copy todir="${dist.dir.dpkg.bridgedgsg}/DEBIAN/"
          file="${dpkg.dir}/copyright"
          filtering="no" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.bridgedgsg}/DEBIAN/control"
          file="${dpkg.dir}/xwhep-bridgedgsg.control"
          filtering="yes" overwrite="yes" />
    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>
    <copy tofile="${dist.dir.dpkg.bridgedgsg}/DEBIAN/preinst"
          file="${dpkg.dir}/xwhep-bridgedgsg.preinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.bridgedgsg}/DEBIAN/postinst"
          file="${dpkg.dir}/xwhep-bridgedgsg.postinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.bridgedgsg}/DEBIAN/prerm"
          file="${dpkg.dir}/xwhep-bridgedgsg.prerm"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.bridgedgsg}/DEBIAN/postrm"
          file="${dpkg.dir}/xwhep-bridgedgsg.postrm"
          filtering="yes" overwrite="yes" />


    <mkdir  dir="${dist.dir.dpkg.client}/DEBIAN" />
    <copy todir="${dist.dir.rpm.client}"
          file="${rpm.dir}/xwhep-client.spec"
	  filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.client}/DEBIAN/control"
          file="${dpkg.dir}/xwhep-client.control"
          filtering="yes" overwrite="yes" />
    <copy todir="${dist.dir.dpkg.client}/DEBIAN/"
          file="${dpkg.dir}/copyright"
          filtering="no" overwrite="yes" />
    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>
    <copy tofile="${dist.dir.dpkg.client}/DEBIAN/preinst"
          file="${dpkg.dir}/xwhep-client.preinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.client}/DEBIAN/postinst"
          file="${dpkg.dir}/xwhep-client.postinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.client}/DEBIAN/prerm"
          file="${dpkg.dir}/xwhep-client.prerm"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.client}/DEBIAN/postrm"
          file="${dpkg.dir}/xwhep-client.postrm"
          filtering="yes" overwrite="yes" />


    <copy todir="${dist.dir.rpm.worker}"
          file="${rpm.dir}/xwhep-worker.spec"
	  filtering="yes" overwrite="yes" />

    <mkdir  dir="${dist.dir.dpkg.worker}/DEBIAN" />
    <copy tofile="${dist.dir.dpkg.worker}/DEBIAN/control"
          file="${dpkg.dir}/xwhep-worker.control"
          filtering="yes" overwrite="yes" />
    <copy todir="${dist.dir.dpkg.worker}/DEBIAN/"
          file="${dpkg.dir}/copyright"
          filtering="no" overwrite="yes" />
    <filter token="XWVERSION" value="${version}"/>
    <filter token="SYSTEMUSER" value="${system.user}"/>
    <copy tofile="${dist.dir.dpkg.worker}/DEBIAN/preinst"
          file="${dpkg.dir}/xwhep-worker.preinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.worker}/DEBIAN/postinst"
          file="${dpkg.dir}/xwhep-worker.postinst"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.worker}/DEBIAN/prerm"
          file="${dpkg.dir}/xwhep-worker.prerm"
          filtering="yes" overwrite="yes" />
    <copy tofile="${dist.dir.dpkg.worker}/DEBIAN/postrm"
          file="${dpkg.dir}/xwhep-worker.postrm"
          filtering="yes" overwrite="yes" />

    <copy file="${build.dir}/stand-alone/${JARFILE}"
	  todir="${dist.dir.worker.innosetup}/worker/lib/"
          overwrite="yes" />
    <copy file="${lib.dir}/bcprov-jdk15on-151.jar"
	  todir="${dist.dir.client.innosetup}/client/lib/"
          overwrite="yes" />
    <copy file="${lib.dir}/bcpkix-jdk15on-151.jar"
	  todir="${dist.dir.client.innosetup}/client/lib/"
          overwrite="yes" />
    <copy file="${build.dir}/stand-alone/${JARFILE}"
	  todir="${dist.dir.client.innosetup}/client/lib/"
          overwrite="yes" />
    <copy file="${build.dir}/stand-alone/${JARFILE}"
	  todir="${dist.dir.server.innosetup}/server/lib/"
          overwrite="yes" />
    <copy file="${build.dir}/stand-alone/${JARFILE}"
	  todir="${dist.dir.win32.worker}/lib/"
          overwrite="yes" />



    <!-- Install distrib -->

    <copy overwrite="yes" todir="${dist.dir}/">
      <fileset dir="${basedir}">
        <include name="AUTHORS"/>
        <include name="ChangeLog"/>
        <include name="COPYING"/>
        <include name="INSTALL"/>
        <include name="License**"/>
      </fileset>
    </copy>

    <!-- Install test -->
    <copy overwrite="yes" todir="${dist.dir}/apptest">
      <fileset dir="${benchmark.dir}/apptest">
        <include name="apptest-*"/>
      </fileset>
    </copy>

    <!-- classpath for execution -->
    <path id="project.classpath" >
      <fileset dir="${dist.dir.lib}">
        <include name="*" />
      </fileset>
    </path>
    <property name="classpath" refid="project.classpath"/>

  </target>


  <target name="installScripts" depends="setupScripts">
  </target>


  <target name="setupScripts" depends="installFiles" >

        <!-- ********************************************** -->
        <!-- **** Note that every following copies uses *** -->
        <!-- ****  filtering (i.e. uses defined tokens) *** -->
        <!-- ********************************************** -->


        <!-- **** Create xwgenkeys script file **** -->
    <filter token="prefix" value="${dist.dir}"/>
    <filter token="datadir" value="../data"/>
    <filter token="exec_prefix" value="."/>
    <filter token="PACKAGE" value="${project}"/>
    <filter token="KEYPASSPHRASE" value="${xw.keypassphrase}"/>
    <filter token="KEYSERVERPASSWORD" value="${xw.server.keypassword}"/>
    <filter token="KEYWORKERPASSWORD" value="${xw.worker.keypassword}"/>
    <filter token="KEYCLIENTPASSWORD" value="${xw.client.keypassword}"/>
    <filter token="WWWDIR" value="${install.www.dir}"/>
    <filter token="sysconfdir" value="../conf"/>
    <filter token="INSTALLDIR" value="${dist.dir}"/>
    <filter token="DEFAULTUSER" value="${xtremweb.admin.login}"/>
    <filter token="DEFAULTPASSWORD" value="${xtremweb.admin.password}"/>
    <filter token="WORKERUSER" value="${xtremweb.worker.login}" />
    <filter token="WORKERPASSWORD" value="${xtremweb.worker.password}" />

    <filter token="SYSTEMUSER" value="${system.user}"/>

    <copy overwrite="yes" 
          filtering="yes"
          todir="${dist.dir.bin}">
      <fileset dir="${src.scripts.dir}/">
        <include name="**" />
      </fileset>
    </copy>
    <copy file="${src.scripts.dir}/db-maintenance/xwhep-core-tables-create-tables.sql.in"
          filtering="no" overwrite="yes"
          todir="${dist.dir.bin}/db-maintenance/" />

    <delete includeEmptyDirs="true" >
      <fileset dir="${dist.dir.bin}" >
        <include name="one_**" />
        <include name="stratuslab_**" />
      </fileset>
    </delete>

  </target>






<!--
    We can't use installApp to install upgradable worker
    since it's a very special case
 -->
  <target name="upgradeWorker" depends="installUpgradableWorker">
  </target>


  <target name="installUpgradableWorker"
   depends="installUpgradableWorkerYes,installUpgradableWorkerNo">
  </target>


  <target name="installUpgradableWorkerNo" unless="installUpgradableWorker" depends="copyWorkerBin">
    <echo>
      Worker already installed in DB
    </echo>
    <fail message="Worker allready in DB">
    </fail>
  </target>


  <target name="installUpgradableWorkerYes" if="installUpgradableWorker" depends="copyWorkerBin">
    <echo>
      Installing worker in DB is not implemented any more
    </echo>
  </target>


  <target name="copyWorkerBin">
    <echo>
      Copying worker bin
    </echo>

    <mkdir dir="${install.www.dir}/db/worker"/>
    <mkdir dir="${install.www.dir}/db/worker/bin"/>
    <copy overwrite="yes" todir="${install.www.dir}/db/worker/bin/">
      <fileset dir="${dist.lib}">
        <include name="${JARFILE}"/>
      </fileset>
    </copy>

  </target>


  <!-- *************************** END OF INSTALL ************************** -->

</project>
